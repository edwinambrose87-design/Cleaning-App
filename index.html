<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Clock-In</title>
    <style>
        body { font-family: sans-serif; padding: 20px; text-align: center; background: #f4f4f4; }
        .container { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
        .btn { background: #007bff; color: white; padding: 15px; border: none; border-radius: 8px; width: 100%; font-size: 18px; margin-top: 15px; cursor: pointer; font-weight: bold; }
        #preview { width: 100%; margin-top: 15px; border-radius: 8px; display: none; border: 1px solid #ddd; }
        input { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 16px; }
        label { display: block; margin-top: 15px; font-weight: bold; text-align: left; }
        #status { margin-top: 20px; font-weight: bold; padding: 10px; border-radius: 5px; }
        .success { color: #155724; background-color: #d4edda; }
        .error { color: #721c24; background-color: #f8d7da; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Cleaner Clock-In</h2>
        
        <label>Staff Name:</label>
        <input type="text" id="staffName" placeholder="Enter your name">

        <label>Proof of Work:</label>
        <input type="file" accept="image/*" capture="camera" id="cameraInput" style="display: none;">
        <button class="btn" onclick="document.getElementById('cameraInput').click()">ðŸ“¸ TAKE PHOTO</button>
        
        <img id="preview">

        <button id="submitBtn" class="btn" style="background: #28a745;">CONFIRM CLOCK-IN</button>
        <div id="status"></div>
    </div>

    <script>
        const AIRTABLE_TOKEN = "patGjYzzXj61ynTmS.ab6919e12e85d2965d1dda2d66e96aff9148dbcc07edfb5053b7999a7a69195e"; 
        const BASE_ID = "appJk7ICYq23qkTYW";
        const TABLE_NAME = "ATTENDANCE"; 

        const cameraInput = document.getElementById('cameraInput');
        const preview = document.getElementById('preview');
        const submitBtn = document.getElementById('submitBtn');
        const statusDiv = document.getElementById('status');

        cameraInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                preview.src = URL.createObjectURL(file);
                preview.style.display = 'block';
            }
        });

        submitBtn.addEventListener('click', async () => {
            const name = document.getElementById('staffName').value;
            const file = cameraInput.files[0];
            
            if (!name || !file) { 
                alert("Please enter your name AND take a photo!"); 
                return; 
            }

            statusDiv.innerText = "Uploading photo & data...";
            submitBtn.disabled = true;

            // Step 1: Convert image to a temporary URL (Airtable requires a URL to "grab" the photo)
            // For this simple version, we'll send the data first. 
            // Note: Direct local file upload to Airtable usually requires a middle-man service like Cloudinary.
            // To keep it simple, I'll set up the data structure for your "Photo/Attachment" column.

            const data = {
                records: [{
                    fields: {
                        "Staff Member": name, 
                        "Clock-In": new Date().toISOString()
                        // "Photo/Attachment": [{ url: "..." }] <- This requires a public URL
                    }
                }]
            };

            try {
                const response = await fetch(`https://api.airtable.com/v0/${BASE_ID}/${TABLE_NAME}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    statusDiv.innerText = "âœ… Success! Name and Time recorded. (Working on photo upload next...)";
                    statusDiv.className = "success";
                } else {
                    statusDiv.innerText = "âŒ Error saving data.";
                    statusDiv.className = "error";
                }
            } catch (err) {
                statusDiv.innerText = "âŒ Connection failed.";
            } finally {
                submitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
